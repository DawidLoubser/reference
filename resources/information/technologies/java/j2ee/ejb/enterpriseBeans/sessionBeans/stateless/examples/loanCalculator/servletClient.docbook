<?xml version="1.0" encoding="UTF-8"?><?oxygen RNGSchema="http://www.oasis-open.org/docbook/xml/5.0/rng/docbookxi.rng" type="xml"?>
<!--DOCTYPE section PUBLIC "-//OASIS//DTD DocBook XML V4.2//EN"
  "http://www.oasis-open.org/docbook/xml/4.2/docbookx.dtd"--><ns2237:section xmlns:ns2237="http://docbook.org/ns/docbook" xml:id="resources.information.technologies.java.j2ee.ejb.enterpriseBeans.sessionBeans.stateless.examples.loanCalculator.servletClient">

  <ns2238:title xmlns:ns2238="http://docbook.org/ns/docbook">Example: LoanCalculator servlet client</ns2238:title>
  <ns2239:para xmlns:ns2239="http://docbook.org/ns/docbook">
    To demonstrate a simple web-based EJB client we create a form within a static 
    HTML page which contains some JavaScript for client-side input validation. 
    The client issues an HTTP request via the <ns2240:literal xmlns:ns2240="http://docbook.org/ns/docbook">submit</ns2240:literal> button 
    which is processed from by  the<ns2241:literal xmlns:ns2241="http://docbook.org/ns/docbook">LoanCalculatorServlet</ns2241:literal> 
    which delegates the business logic to the LoanCalculator session bean
    and then transfers control to a JSP for generating the response page.
  </ns2239:para>
  
  <ns2242:section xmlns:ns2242="http://docbook.org/ns/docbook">
    <ns2243:title xmlns:ns2243="http://docbook.org/ns/docbook">Loan Calculator HTML File: index.html</ns2243:title>
    <ns2244:para xmlns:ns2244="http://docbook.org/ns/docbook">
<ns2245:programlisting xmlns:ns2245="http://docbook.org/ns/docbook">
<xi:include xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" parse="text" href="../../../../../source/LoanCalculator/src/servlet/web/index.html"/>
</ns2245:programlisting>    
    </ns2244:para>
  </ns2242:section>
  
  <ns2246:section xmlns:ns2246="http://docbook.org/ns/docbook">
    <ns2247:title xmlns:ns2247="http://docbook.org/ns/docbook">Loan Calculator Servlet</ns2247:title>
    <ns2248:para xmlns:ns2248="http://docbook.org/ns/docbook">
      The servlet extracts the form parameters, uses the business logic hosted by the
      session bean and transfers control to a JSP for generating the response page. As with the
      client application, the loan calculator servlet obtains a reference to the home interface
      through JNDI and creates a session bean through it:
<ns2249:programlisting xmlns:ns2249="http://docbook.org/ns/docbook">
<xi:include xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" parse="text" href="../../../../../source/LoanCalculator/src/servlet/LoanCalculatorServlet.java"/>
</ns2249:programlisting>  
    </ns2248:para>
  </ns2246:section>
  
  <ns2250:section xmlns:ns2250="http://docbook.org/ns/docbook">
    <ns2251:title xmlns:ns2251="http://docbook.org/ns/docbook">The Generic Web Deployment Descriptor: web.xml</ns2251:title>
    <ns2252:para xmlns:ns2252="http://docbook.org/ns/docbook">
      In the generic <ns2253:literal xmlns:ns2253="http://docbook.org/ns/docbook">web.xml</ns2253:literal> deployment descriptor we
      map, as usual, the servlet onto a URL which will be dynamically 
      generated by the servlet.
<ns2254:programlisting xmlns:ns2254="http://docbook.org/ns/docbook">
<xi:include xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" parse="text" href="../../../../../source/LoanCalculator/WEB-INF/web.xml"/>
</ns2254:programlisting>  
    </ns2252:para>
    <ns2255:note xmlns:ns2255="http://docbook.org/ns/docbook"><ns2256:para xmlns:ns2256="http://docbook.org/ns/docbook">
      The <ns2257:literal xmlns:ns2257="http://docbook.org/ns/docbook">web.xml</ns2257:literal> file contains an ejb-reference
      with the home and remote interfaces specifications. We also 
      specify the default (welcome) file when the servlet context is 
      loaded.
    </ns2256:para></ns2255:note>
  </ns2250:section>
  
  <ns2258:section xmlns:ns2258="http://docbook.org/ns/docbook">
    <ns2259:title xmlns:ns2259="http://docbook.org/ns/docbook">The JBoss-Specific Web Deployment Descriptor: jboss-web.xml</ns2259:title>
    <ns2260:para xmlns:ns2260="http://docbook.org/ns/docbook">
      The JBoss-specific web deployment descriptor,  
      <ns2261:literal xmlns:ns2261="http://docbook.org/ns/docbook">jboss-web.xml</ns2261:literal> provides the JNDI mapping for the enterprise
      bean accessed by the servlet:
<ns2262:programlisting xmlns:ns2262="http://docbook.org/ns/docbook">
<xi:include xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" parse="text" href="../../../../../source/LoanCalculator/WEB-INF/jboss-web.xml"/>
</ns2262:programlisting>  
    </ns2260:para>
  </ns2258:section>
  
  <ns2263:section xmlns:ns2263="http://docbook.org/ns/docbook">
    <ns2264:title xmlns:ns2264="http://docbook.org/ns/docbook">Creating a Web Archive</ns2264:title>
    <ns2265:para xmlns:ns2265="http://docbook.org/ns/docbook">
      The web archive (WAR file) is a standard jar file which contains the servlet(s),
      JSPs, HTML files and web deployment descriptors in a directory hierarchy 
      satisfying the servlet specification: 
      <ns2266:itemizedlist xmlns:ns2266="http://docbook.org/ns/docbook">
        <ns2267:listitem xmlns:ns2267="http://docbook.org/ns/docbook">
          <ns2268:para xmlns:ns2268="http://docbook.org/ns/docbook">
            The HTML and JSP resources are put relative to the archive's root 
            directory in the URL directory structure. 
          </ns2268:para>
        </ns2267:listitem>
        <ns2269:listitem xmlns:ns2269="http://docbook.org/ns/docbook">
          <ns2270:para xmlns:ns2270="http://docbook.org/ns/docbook">
            The <ns2271:literal xmlns:ns2271="http://docbook.org/ns/docbook">web.xml</ns2271:literal> and  
            <ns2272:literal xmlns:ns2272="http://docbook.org/ns/docbook">web-jboss.xml</ns2272:literal> deployment descriptors are 
            inserted into a <ns2273:literal xmlns:ns2273="http://docbook.org/ns/docbook">WEB-INF</ns2273:literal> sub-directory. 
          </ns2270:para>
        </ns2269:listitem>
        <ns2274:listitem xmlns:ns2274="http://docbook.org/ns/docbook">
          <ns2275:para xmlns:ns2275="http://docbook.org/ns/docbook">
            The servlet class (and its support classes) are located in a  
            <ns2276:literal xmlns:ns2276="http://docbook.org/ns/docbook">classes</ns2276:literal> sub-directory of the  <ns2277:literal xmlns:ns2277="http://docbook.org/ns/docbook">WEB-INF</ns2277:literal> 
            directory.
          </ns2275:para>
        </ns2274:listitem>
      </ns2266:itemizedlist>
    </ns2265:para>
    <ns2278:para xmlns:ns2278="http://docbook.org/ns/docbook">
      Our generic targets file, <ns2279:literal xmlns:ns2279="http://docbook.org/ns/docbook">targets.xml</ns2279:literal> contains
      targets for compiling the servlet:
<ns2280:programlisting xmlns:ns2280="http://docbook.org/ns/docbook">
&lt;target name="compileServlet" depends="compileCommon"&gt;
&lt;echo message="Compiling servlet classes ... ${srcDirServlet}"/&gt;
&lt;javac srcdir="${srcDirServlet}"
      destdir="${buildDirServlet}/WEB-INF/classes"
      deprecation="${compile.deprecation}"
      optimize="${compile.optimize}"
      debug="${compile.debug}"
      includes="**/*.java"&gt;
      &lt;classpath path="${classpath}"&gt;
        &lt;path refid="jboss.jars"/&gt;
        &lt;path refid="servlet.jar"/&gt;
        &lt;path location="${buildDirCommon}"/&gt;
        &lt;path location="${buildDirServlet}"/&gt;
      &lt;/classpath&gt;
&lt;/javac&gt;
&lt;/target&gt;
</ns2280:programlisting>
      and for generating the web archive:
 <ns2281:programlisting xmlns:ns2281="http://docbook.org/ns/docbook">
&lt;target name="createWar" depends="compileServlet"&gt;
&lt;echo message="Creating web archive ..."/&gt;
&lt;delete file="${distDir}/${web-jar}"/&gt;
&lt;jar jarfile="${distDir}/${web-jar}"&gt;
 &lt;fileset dir="${buildDirServlet}" includes="**/*.class"/&gt;
 &lt;fileset dir="${basedir}" includes="WEB-INF/**"/&gt;
 &lt;fileset dir="${srcDirServletWeb}" includes="**"/&gt;
&lt;/jar&gt;
&lt;/target&gt;
</ns2281:programlisting>
    </ns2278:para>
  </ns2263:section>
  
  <ns2282:section xmlns:ns2282="http://docbook.org/ns/docbook">
    <ns2283:title xmlns:ns2283="http://docbook.org/ns/docbook">Creating an Enterprise Application Archive</ns2283:title>
    <ns2284:para xmlns:ns2284="http://docbook.org/ns/docbook">
      The jar file for the enterprise bean and the web components are packaged 
      within a further, single jar file, a enterprise application archive (EAR) file. 
      For the application one defines a further deployment descriptor, the 
      application deployment descriptor saved in the<ns2285:literal xmlns:ns2285="http://docbook.org/ns/docbook">META-INF</ns2285:literal> 
      directory as a  <ns2286:literal xmlns:ns2286="http://docbook.org/ns/docbook">application.xml</ns2286:literal> file. It specifies the war 
      and the EJB jar:
<ns2287:programlisting xmlns:ns2287="http://docbook.org/ns/docbook">
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;application&gt;
&lt;display-name&gt;LoanCalculator&lt;/display-name&gt;
&lt;module&gt;
 &lt;web&gt;
   &lt;web-uri&gt;LoanCalculator.war&lt;/web-uri&gt;
   &lt;context-root&gt;/LoanCalculator&lt;/context-root&gt;
 &lt;/web&gt;
&lt;/module&gt;
&lt;module&gt;
 &lt;ejb&gt;LoanCalculator.jar&lt;/ejb&gt;
&lt;/module&gt;
&lt;/application&gt;
</ns2287:programlisting>
    </ns2284:para>
  </ns2282:section>
  
  <ns2288:section xmlns:ns2288="http://docbook.org/ns/docbook">
    <ns2289:title xmlns:ns2289="http://docbook.org/ns/docbook">Running the Web Client</ns2289:title>
    <ns2290:para xmlns:ns2290="http://docbook.org/ns/docbook">
      By default the JBoss distribution runs Tomcat as web server on port 8080. 
      To launch the web client use the following URL
<ns2291:programlisting xmlns:ns2291="http://docbook.org/ns/docbook">
http://localhost:8080/LoanCalculator
</ns2291:programlisting>
      Instead of  <ns2292:literal xmlns:ns2292="http://docbook.org/ns/docbook">localhost</ns2292:literal> the name of the machine which 
      hosts the application server can be specified.
    </ns2290:para>
    <ns2293:figure xmlns:ns2293="http://docbook.org/ns/docbook" xml:id="resources.information.technologies.java.j2ee.ejb.enterpriseBeans.sessionBeans.stateless.examples.loanCalculator.loanCalculatorServletInput_jpg">
      <ns2294:title xmlns:ns2294="http://docbook.org/ns/docbook">The client application screen.</ns2294:title>
      <mediaobject xmlns:xi="http://www.w3.org/2001/XInclude" xmlns="http://docbook.org/ns/docbook"><imageobject><imagedata fileref="loanCalculatorServletInput.jpg"/></imageobject></mediaobject>
    </ns2293:figure>
    <ns2295:para xmlns:ns2295="http://docbook.org/ns/docbook">
      <ns2296:xref xmlns:ns2296="http://docbook.org/ns/docbook" linkend="resources.information.technologies.java.j2ee.ejb.enterpriseBeans.sessionBeans.stateless.examples.loanCalculator.loanCalculatorServletInput_jpg"/>
      shows th input form for the servlet while
      <ns2297:xref xmlns:ns2297="http://docbook.org/ns/docbook" linkend="resources.information.technologies.java.j2ee.ejb.enterpriseBeans.sessionBeans.stateless.examples.loanCalculator.loanCalculatorServletOutput_jpg"/>
      shows the resultant output.
    </ns2295:para>
    <ns2298:figure xmlns:ns2298="http://docbook.org/ns/docbook" xml:id="resources.information.technologies.java.j2ee.ejb.enterpriseBeans.sessionBeans.stateless.examples.loanCalculator.loanCalculatorServletOutput_jpg">
      <ns2299:title xmlns:ns2299="http://docbook.org/ns/docbook">The client application screen.</ns2299:title>
      <mediaobject xmlns:xi="http://www.w3.org/2001/XInclude" xmlns="http://docbook.org/ns/docbook"><imageobject><imagedata fileref="loanCalculatorServletOutput.jpg"/></imageobject></mediaobject>
    </ns2298:figure>
  </ns2288:section>
</ns2237:section>